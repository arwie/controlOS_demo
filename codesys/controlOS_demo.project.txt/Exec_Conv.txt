PROGRAM Exec_Conv
VAR
	ReadSetPosition: SMC_ReadSetPosition;

	StatusPowerAxis: FB_StatusPowerAxis;
	Halt: MC_Halt;

	MoveVelocity: MC_MoveVelocity;
	Jog: MC_Jog;
END_VAR

////////////////////////////////

ReadSetPosition(
	Axis := Conv,
	Enable := TRUE,
	Position => app.fbk.conv_pos
);


StatusPowerAxis(
	Axis := Conv,
	power := app.cmd.conv_power,
	powered => app.fbk.conv_powered
);


Halt(
	Axis := Conv,
	Execute := StatusPowerAxis.powered AND app.cmd.conv_move = 0,
	Deceleration := app.cfg.conv_acc,
	Jerk         := app.cfg.conv_jrk,
);


ResetErrorDone();


//1: MoveVelocity
MoveVelocity(
	Axis := Conv,
	Execute := app.cmd.conv_move = 1,
	BufferMode := MC_BUFFER_MODE.Aborting,
	Velocity     := app.cmd.conv_move_vel,
	Acceleration := app.cfg.conv_acc,
	Deceleration := app.cfg.conv_acc,
	Jerk         := app.cfg.conv_jrk,
);
SetErrorDone(MoveVelocity.Error, FALSE);


//99: JOG
Jog(
	Axis := Conv,
	JogForward  := app.cmd.conv_move = 99 AND app.cmd.conv_move_vel > 0,
	JogBackward := app.cmd.conv_move = 99 AND app.cmd.conv_move_vel < 0,
	Velocity     := ABS(app.cmd.conv_move_vel),
	Acceleration := app.cfg.conv_acc,
	Deceleration := app.cfg.conv_acc,
	Jerk         := app.cfg.conv_jrk,
);
SetErrorDone(Jog.Error, FALSE);
