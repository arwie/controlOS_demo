{% extends "../page.html" %}


{% block html %}
<div class="form-group">
	<label data-l10n-id="teach_position"></label>
	<div data-bind="foreach:['x','y','z','r']" class="row">
		<div class="input-group col-lg">
			<div class="input-group-prepend"><span data-bind="text:$data.toUpperCase()" class="input-group-text"></span></div>
			<input data-bind="value:$model.info.pos[$data]().toFixed(2)" type="text" class="form-control" readonly>
		</div>
	</div>
</div>

<div class="form-group">
	<label data-l10n-id="teach_speed"></label>
	<input data-bind="value:$model.speed" type="range" min="1" max="15" step="1" class="custom-range">
</div>

<div class="row my-5">
	<div class="col">
		<button data-bind="press:{start:()=>{$model.moveDim(3,-1)}, stop:$model.moveStop}" class="btn btn-block btn-lg btn-secondary"><i class="fa fa-minus"></i> Z</button>
	</div>
	<div class="col"></div>
	<div class="col">
		<button data-bind="press:{start:()=>{$model.moveDim(2,-1)}, stop:$model.moveStop}" class="btn btn-block btn-lg btn-secondary"><i class="fa fa-minus"></i> Y</button>
	</div>
	<div class="col"></div>
	<div class="col">
		<button data-bind="press:{start:()=>{$model.moveDim(4,-1)}, stop:$model.moveStop}" class="btn btn-block btn-lg btn-secondary"><i class="fa fa-minus"></i> R</button>
	</div>
</div>
<div class="row my-5">
	<div class="col"></div>
	<div class="col">
		<button data-bind="press:{start:()=>{$model.moveDim(1,-1)}, stop:$model.moveStop}" class="btn btn-block btn-lg btn-secondary"><i class="fa fa-minus"></i> X</button>
	</div>
	<div class="col"></div>
	<div class="col">
		<button data-bind="press:{start:()=>{$model.moveDim(1, 1)}, stop:$model.moveStop}" class="btn btn-block btn-lg btn-secondary"><i class="fa fa-plus" ></i> X</button>
	</div>
	<div class="col"></div>
</div>
<div class="row my-5">
	<div class="col">
		<button data-bind="press:{start:()=>{$model.moveDim(3, 1)}, stop:$model.moveStop}" class="btn btn-block btn-lg btn-secondary"><i class="fa fa-plus" ></i> Z</button>
	</div>
	<div class="col"></div>
	<div class="col">
		<button data-bind="press:{start:()=>{$model.moveDim(2, 1)}, stop:$model.moveStop}" class="btn btn-block btn-lg btn-secondary"><i class="fa fa-plus" ></i> Y</button>
	</div>
	<div class="col"></div>
	<div class="col">
		<button data-bind="press:{start:()=>{$model.moveDim(4, 1)}, stop:$model.moveStop}" class="btn btn-block btn-lg btn-secondary"><i class="fa fa-plus"></i> R</button>
	</div>
</div>
{% end %}


{% block model %}
class {
	constructor() {
		this.info = ko.mapping.fromJS({});
		this.speed = ko.observable('5');
	}
	
	moveDim(dim, dir)	{ model.mc.sendJson({cmd:1, dim:dim, dir:dir, speed:parseInt(model.speed())}); }
	moveStop()			{ model.mc.sendJson({cmd:0}); }
	
	start(started) {
		model.mc = webSocket(wsUrl('mc', 55001), (data, first)=>{
			ko.mapping.fromJS(data, model.info);
			if (first) started();
		});
	}
	
	stop() {
		model.mc.close();
	}
}
{% end %}


{% block guard %}
	return gui.isState('mc@teach');
{% end %}
