<?com_websocket(55003)?>

dim shared this_pickHeight		as const double	= 122
dim shared this_travHeight		as const double	= 100
dim shared this_scanPos			as location of xyzr = #{130, 0, this_travHeight, 0}



<?lib_prgStart()?>
	delta1_enableAttach()
	tool_select(tool_typeMagnet)
	moves this_scanPos vrate=10
end sub


<?com_prgReceive('this_websocket', 200)?>
	select case receive_
	case com_receiveMessage
		delta1_enableAttach()
		fetchObject()
	case com_receiveTimeout
		if not (delta1_disabled or isMoving) then
			delta1_disable()
		end if
	end select
end sub


<?lib_prgStop()?>
	tool_select(tool_typeNone)
	delta1_disableDetach()
end sub


<?lib_prgError()?>
	stop stoptype=ABORT
	if not prgRunning then
		shaker_prgStop()
		shaker_stopTrigger()
	end if
end sub


sub fetchObject
	dim objectPos_ as location of xyzr = com_getLocationXyzr("/pos")
	moves posWithHeight(objectPos_, this_travHeight)
	moves posWithHeight(objectPos_, this_pickHeight)
	tool_grip(true)
	waitForMotion
	sleepActive(10)
	moves posWithHeight(objectPos_, this_travHeight)
	moves this_scanPos
	waitForMotion
	tool_grip(false)
	sleepActive(10)
end sub


function posWithHeight(byval pos_ as location of xyzr, byval height_ as double) as location of xyzr
	pos_{3} = height_
	posWithHeight = pos_
	print posWithHeight
end function
