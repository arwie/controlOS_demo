<?axis([
	'device'		=> 'stepim',
	'bus'			=> 'can',
#	'simulated'		=> true
])?>


common shared conv_frame as moving frame of xyzr

dim shared this_upStream		as location of xyzr = #{<?=conf(lib(),'upstream',  'x', 0)?>, <?=conf(lib(),'upstream',  'y', +150)?>, 0,0}
dim shared this_downStream		as location of xyzr = #{<?=conf(lib(),'downstream','x', 0)?>, <?=conf(lib(),'downstream','y', -150)?>, 0,0}
dim shared this_streamLength	as double = distl(this_upStream, this_downStream)


<?lib_init()?>
	conv_frame.type						= 0
	conv_frame.numberDegreesOfFreedom	= 1
	conv_frame.masterSource				= positionCommand
	conv_frame.upStream[1]				= this_upStream
	conv_frame.downStream[1]			= this_downStream
	conv_frame.upMaster[1]				= 0
	conv_frame.downMaster[1]			= conv_frame.upMaster[1] + this_streamLength
end sub


<?drive_update(3)?>
	conv_driveTune(30000, 0, 0, 414, 3000, 30)
end sub


<?drive_setup()?>
	dim streamCounts_ as long = <?=conf(lib(),'downstream','c', 'positionfactor')?> - <?=conf(lib(),'upstream','c', 0)?>'
	positionfactor				= abs(streamCounts_) / this_streamLength
	direction					= sgn(streamCounts_)
end sub


<?axis_setup()?>
	absolute					= false
	axistype					= 0
	
	<?axis_setupSpeed(250)?>
	
	positionerrormax			= 5
end sub



<?lib_debug()?>
	'com_putLocationXyzr("frame/here",		conv_frame.here)
	'com_putLocationXyzr("frame/zero",		conv_frame.zero)
	com_putDouble("velocityCommand",		velocityCommand)
end sub
